System.register(["jimu-core","jimu-ui"],(function(t,e){var a={},o={};return{setters:[function(t){a.DataSourceComponent=t.DataSourceComponent,a.DataSourceManager=t.DataSourceManager,a.DataSourceStatus=t.DataSourceStatus,a.Immutable=t.Immutable,a.React=t.React},function(t){o.Button=t.Button,o.Loading=t.Loading,o.LoadingType=t.LoadingType}],execute:function(){t((()=>{var t={8891:t=>{"use strict";t.exports=a},726:t=>{"use strict";t.exports=o}},e={};function u(a){var o=e[a];if(void 0!==o)return o.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,u),r.exports}u.d=(t,e)=>{for(var a in e)u.o(e,a)&&!u.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},u.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),u.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},u.p="";var r={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(r),u.d(r,{__set_webpack_public_path__:()=>o,default:()=>a});var t=u(8891),e=u(726);class a extends t.React.PureComponent{constructor(e){super(e),this.isDsConfigured=()=>!(!this.props.useDataSources||1!==this.props.useDataSources.length),this.outputDataDataRender=(e,a)=>t.React.createElement("div",null,t.React.createElement("div",{className:"mt-2"}),"Output data source records:",e&&e.getRecords().map(((a,o)=>t.React.createElement("div",{key:o},Object.keys(e.getSchema().fields).filter((t=>"objectid"!==t)).map(((e,o)=>t.React.createElement("div",{key:o},`${e}: ${a.getData()[e]}`))))))),this.onDataSourceCreated=t=>{this.setSourceRecordsToOutputDs()},this.onCreateDataSourceFailed=()=>{this.setSourceRecordsToOutputDs()},this.onOutputDataSourceInfoChange=e=>{e.status===t.DataSourceStatus.Loading?this.setState({isLoading:!0}):this.setState({isLoading:!1})},this.getOriginDataSource=()=>{var e,a;return t.DataSourceManager.getInstance().getDataSource(null===(a=null===(e=this.props.useDataSources)||void 0===e?void 0:e[0])||void 0===a?void 0:a.dataSourceId)},this.getOutputDataSource=()=>{var e;return t.DataSourceManager.getInstance().getDataSource(null===(e=this.props.outputDataSources)||void 0===e?void 0:e[0])},this.setSourceRecordsToOutputDs=()=>{var e;if(!this.getOutputDataSource())return;if(!(this.getOriginDataSource()&&(null===(e=this.props.config.statFunctions)||void 0===e?void 0:e.length)>0&&this.props.config.numberField))return this.getOutputDataSource().setStatus(t.DataSourceStatus.NotReady),void this.getOutputDataSource().setCountStatus(t.DataSourceStatus.NotReady);const a=this.props.config.statFunctions.asMutable().map((t=>({onStatisticField:this.props.config.numberField,outStatisticFieldName:t,statisticType:t})));this.getOriginDataSource().query({outFields:["*"],outStatistics:a}).then((e=>{var a,o,u;const r=e.records.map(((t,e)=>{const a=t,o=a.getData();return o.objectid=e,a.feature.attributes=o,t}));null===(a=this.getOutputDataSource())||void 0===a||a.setSourceRecords(r),null===(o=this.getOutputDataSource())||void 0===o||o.setStatus(t.DataSourceStatus.Unloaded),null===(u=this.getOutputDataSource())||void 0===u||u.setCountStatus(t.DataSourceStatus.Unloaded)}),(t=>{console.error(`${this.props.id} loading data error, `,t)}))},this.state={isLoading:!1}}render(){var a;return this.isDsConfigured()?t.React.createElement("div",{className:"widget-use-feature-set",style:{width:"100%",height:"100%",maxHeight:"800px",overflow:"auto"}},t.React.createElement("h3",null,"The output data source is generated."),t.React.createElement("h5",null,"Data of the output data source is statistic query result of the selected field and the selected statistic functions."),t.React.createElement("h5",null,"The widget will list the records of the output data source."),t.React.createElement("h5",null,"If the widget's origin data source is changed (e.g. add a filter), the output data source won't update automatically. Please click the following button."),t.React.createElement(e.Button,{onClick:this.setSourceRecordsToOutputDs,className:"mb-5"},"Update output data source"),t.React.createElement(t.DataSourceComponent,{useDataSource:this.props.useDataSources[0],onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed}),this.state.isLoading&&t.React.createElement(e.Loading,{type:e.LoadingType.Secondary}),(null===(a=this.props.outputDataSources)||void 0===a?void 0:a[0])&&t.React.createElement(t.DataSourceComponent,{useDataSource:(0,t.Immutable)({dataSourceId:this.props.outputDataSources[0],mainDataSourceId:this.props.outputDataSources[0]}),queryCount:!0,widgetId:this.props.id,query:{where:"1=1"},onDataSourceInfoChange:this.onOutputDataSourceInfoChange},this.outputDataDataRender)):t.React.createElement(t.React.Fragment,null,t.React.createElement("h3",null,"This widget demonstrates how to use statistic query results to generate a client-side output data source."),t.React.createElement("h4",null,"Please config data source.",t.React.createElement("br",null),"Then, please select a field and add some statistic functions."))}}function o(t){u.p=t}})(),r})())}}}));