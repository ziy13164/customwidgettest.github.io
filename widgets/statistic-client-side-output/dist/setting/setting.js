System.register(["jimu-core","jimu-ui/advanced/data-source-selector","jimu-ui"],(function(e,t){var s={},a={},i={};return{setters:[function(e){s.DataSourceManager=e.DataSourceManager,s.DataSourceTypes=e.DataSourceTypes,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.React=e.React},function(e){a.DataSourceSelector=e.DataSourceSelector,a.FieldSelector=e.FieldSelector},function(e){i.MultiSelect=e.MultiSelect}],execute:function(){e((()=>{var e={8891:e=>{"use strict";e.exports=s},726:e=>{"use strict";e.exports=i},338:e=>{"use strict";e.exports=a}},t={};function o(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var u={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(u),o.d(u,{default:()=>i});var e,t=o(8891),s=o(338),a=o(726);!function(e){e.avg="avg",e.sum="sum",e.min="min",e.max="max"}(e||(e={}));class i extends t.React.PureComponent{constructor(){super(...arguments),this.supportedTypes=(0,t.Immutable)([t.DataSourceTypes.FeatureLayer]),this.numberFieldTypes=(0,t.Immutable)([t.JimuFieldType.Number]),this.onFieldSelected=(e,t)=>{var s,a;const i=this.getOutputDsJson(this.props.useDataSources[0].asMutable({deep:!0}),null===(s=e[0])||void 0===s?void 0:s.jimuName,this.getSelectedStatFuncs()),o=Object.assign(Object.assign({},this.props.useDataSources[0]),{fields:e.map((e=>e.jimuName))});this.props.onSettingChange({id:this.props.id,useDataSources:[o],config:Object.assign(Object.assign({},this.props.config),{numberField:null===(a=e[0])||void 0===a?void 0:a.jimuName})},[i])},this.onDataSourceChange=e=>{if((null==e?void 0:e.length)>0){const t=this.getOutputDsJson(e[0]);this.props.onSettingChange({id:this.props.id,useDataSources:e,config:{}},[t])}},this.getOutputDsJson=(e,s,a)=>{const i=e.dataSourceId,o=t.DataSourceManager.getInstance().getDataSource(i),u=this.getOutputDsSchema(s,a);return{id:`${this.props.id}_ouput`,type:t.DataSourceTypes.FeatureLayer,label:u.label,geometryType:o.getDataSourceJson().geometryType,originDataSources:[e],schema:u,isDataInDataSourceInstance:!0}},this.getOutputDsSchema=(e,s)=>{const a={};return s&&s.forEach((s=>{a[s]={jimuName:s,type:t.JimuFieldType.Number,name:s,originFields:e?[e]:[]}})),{label:`${this.props.manifest.name}-output-data-source`,idField:"objectid",fields:Object.assign({objectid:{jimuName:"objectid",type:t.JimuFieldType.Number,name:"objectid"}},a)}},this.getStatFuncItems=()=>(0,t.Immutable)(Object.keys(e).map((e=>({value:e,label:e})))),this.getSelectedStatFuncs=()=>this.props.config.statFunctions,this.onStatFuncItemClick=(e,s,a)=>{var i,o;const u=this.getOutputDsJson(this.props.useDataSources[0].asMutable({deep:!0}),null===(o=null===(i=this.props.useDataSources[0])||void 0===i?void 0:i.fields)||void 0===o?void 0:o[0],(0,t.Immutable)(a));this.props.onSettingChange({id:this.props.id,useDataSources:this.props.useDataSources.asMutable({deep:!0}),config:Object.assign(Object.assign({},this.props.config),{statFunctions:a})},[u])}}render(){return t.React.createElement("div",{className:"use-feature-layer-setting p-2"},t.React.createElement(s.DataSourceSelector,{mustUseDataSource:!0,types:this.supportedTypes,useDataSources:this.props.useDataSources,useDataSourcesEnabled:this.props.useDataSourcesEnabled,onChange:this.onDataSourceChange,widgetId:this.props.id}),this.props.useDataSources&&this.props.useDataSources[0]&&t.React.createElement("div",{className:"mt-3 px-2"},t.React.createElement("div",{className:"my-2"},"Please select a field."),t.React.createElement(s.FieldSelector,{useDataSources:this.props.useDataSources,onChange:this.onFieldSelected,selectedFields:this.props.config.numberField?(0,t.Immutable)([this.props.config.numberField]):null,types:this.numberFieldTypes,useDropdown:!0,isDataSourceDropDownHidden:!0,isSearchInputHidden:!0}),t.React.createElement("div",{className:"my-2"},"Please select a statistic function."),t.React.createElement(a.MultiSelect,{fluid:!0,items:this.getStatFuncItems(),values:this.getSelectedStatFuncs(),onClickItem:this.onStatFuncItemClick})))}}})(),u})())}}}));